# Save Context Command

## Description

Intelligent session memory preservation system that archives current development context, findings, and decisions to Pieces long-term memory with comprehensive tagging and research integration. This command ensures valuable insights, architectural decisions, and implementation patterns are preserved for future agent sessions and cross-project learning.

## User Prompt: $ARGUMENTS

**What This Command Does:**

1. **Context Analysis**: Analyzes current conversation and session state for key insights
2. **Intelligent Tagging**: Applies comprehensive tagging schema for optimal retrieval
3. **Research Integration**: Preserves MCP research findings and pattern discoveries
4. **Structured Storage**: Organizes memories with framework-specific classification
5. **Cross-Agent Accessibility**: Makes context available to all future agent sessions

**Framework Philosophy Integration:**

- **Intelligence Through Context**: Preserves research-backed decisions for future reference
- **Memory Consistency**: Ensures agent coordination through persistent context
- **Prompt Engineering Excellence**: Tags memories for optimal retrieval and utilization
- **HITL Empowerment**: Users control what gets preserved and how it's organized

## Workflow

### Phase 1: Session Analysis & Context Extraction (15 sec)

**Goal**: Analyze current conversation and session state to identify valuable context for preservation.

1. **Conversation Analysis**: Extract key insights from current session

   ```
   üìã ANALYZING CURRENT SESSION...

   Context Identification:
   ‚Ä¢ Scanning conversation for architectural decisions
   ‚Ä¢ Identifying implementation patterns and approaches discovered
   ‚Ä¢ Extracting research findings from MCP tool usage
   ‚Ä¢ Locating quality standards and escalation triggers applied
   ‚Ä¢ Finding successful code patterns and solutions
   ‚Ä¢ Capturing user preferences and project-specific requirements
   ```

2. **Content Classification**: Determine memory type and appropriate tagging

   ```
   üè∑Ô∏è  CLASSIFYING CONTEXT TYPE:

   Auto-Detected Context Types:
   ‚Ä¢ Architecture Decision: Major design choices and rationale
   ‚Ä¢ Implementation Pattern: Proven code approaches and techniques
   ‚Ä¢ Research Finding: MCP-backed discoveries and validated patterns
   ‚Ä¢ Quality Standard: Testing, linting, and validation approaches
   ‚Ä¢ User Preference: Project-specific choices and requirements
   ‚Ä¢ Integration Solution: Service connections and API patterns
   ‚Ä¢ Debugging Session: Problem resolution and troubleshooting
   ‚Ä¢ Agent Coordination: Multi-agent workflow insights
   ```

3. **Project Context Integration**: Connect to current project and technology stack

   ```
   üîó PROJECT CONTEXT INTEGRATION:

   ‚Ä¢ Project Name: [DETECTED_PROJECT_NAME]
   ‚Ä¢ Technology Stack: [DETECTED_TECH_STACK]
   ‚Ä¢ Framework Context: [DETECTED_FRAMEWORK_PATTERNS]
   ‚Ä¢ Current Development Phase: [INFERRED_PHASE]
   ```

### Phase 2: User Validation & Memory Customization (Strong HITL - 30 sec)

**Goal**: Ensure user control over what gets preserved and how it's organized through comprehensive validation.

1. **Context Preview & Validation**:

   ```
   üìù MEMORY PREVIEW FOR VALIDATION:

   I've identified these key insights from our session:

   üéØ PRIMARY CONTEXT:
   ‚Ä¢ [EXTRACTED_PRIMARY_INSIGHT]
     - Category: [AUTO_DETECTED_CATEGORY]
     - Tags: [PROPOSED_TAG_LIST]
     - HITL: Does this accurately capture the key insight?

   üî¨ RESEARCH INTEGRATION:
   ‚Ä¢ MCP Findings: [SUMMARY_OF_MCP_RESEARCH_USED]
     - Sources: Crawl4AI: [X docs], Octocode: [Y repos], Sequential: [Z analyses]
     - HITL: Should I preserve the research context that informed this decision?

   üìä IMPLEMENTATION CONTEXT:
   ‚Ä¢ Code Patterns: [IDENTIFIED_PATTERNS]
   ‚Ä¢ Quality Standards: [APPLIED_STANDARDS]
     - HITL: Are these patterns worth preserving for future reference?

   üö® DECISION CONTEXT:
   ‚Ä¢ Critical Decisions: [ARCHITECTURE_OR_DESIGN_DECISIONS]
   ‚Ä¢ Escalation Triggers: [QUALITY_GATES_APPLIED]
     - HITL: Should I document the rationale behind these decisions?
   ```

2. **Comprehensive Tagging Schema Application**:

   ```
   üè∑Ô∏è  MEMORY TAGGING CONFIGURATION:

   Based on comprehensive framework taxonomy, I recommend:

   üìã SUGGESTED TAGGING SCHEMA:
   ‚Ä¢ Namespace: framework:[AGENT_TYPE]:[PROJECT_SCOPE]:[CONTENT_TYPE]:[CONTEXT]
   ‚Ä¢ Primary Tags: [SUGGESTED_PRIMARY_TAGS]
   ‚Ä¢ Secondary Tags: [SUGGESTED_SECONDARY_TAGS]
   ‚Ä¢ Context Tags: [PROJECT_SPECIFIC_CONTEXT_TAGS]

   HITL CUSTOMIZATION:
   ‚Ä¢ Are these tags appropriate for easy retrieval?
   ‚Ä¢ Any additional tags needed for your project workflow?
   ‚Ä¢ Should I adjust the classification for better organization?
   ‚Ä¢ Want to add custom project-specific tags?

   üìö TAGGING EXAMPLES FOR CONTEXT:
   ‚Ä¢ Architecture Decision: framework:developer:project:architecture:api-design
   ‚Ä¢ Research Finding: framework:researcher:global:pattern:testing-approaches
   ‚Ä¢ Quality Standard: framework:tester:project:standard:coverage-threshold
   ‚Ä¢ User Preference: framework:coordinator:project:preference:deployment-strategy
   ```

3. **Memory Summary & Description Customization**:

   ```
   üìñ MEMORY SUMMARY CUSTOMIZATION:

   I've drafted this summary for the memory:

   Title: "[AUTO_GENERATED_TITLE]"

   Summary: "[AUTO_GENERATED_SUMMARY_WITH_CONTEXT]"

   Key Context:
   ‚Ä¢ What: [WHAT_WAS_ACCOMPLISHED_OR_DECIDED]
   ‚Ä¢ Why: [REASONING_AND_RESEARCH_BACKING]
   ‚Ä¢ How: [IMPLEMENTATION_APPROACH_OR_PATTERN]
   ‚Ä¢ When: [SESSION_TIMESTAMP_AND_PROJECT_PHASE]

   HITL VALIDATION:
   ‚Ä¢ Does this title accurately describe the memory?
   ‚Ä¢ Should I adjust the summary for better future retrieval?
   ‚Ä¢ Any specific details to emphasize or de-emphasize?
   ‚Ä¢ Want to add project-specific context for future agents?
   ```

### Phase 3: Research Context & Pattern Preservation (10 sec)

**Goal**: Preserve MCP research findings and patterns that informed the decisions for future agent reference.

1. **MCP Research Integration**:

   ```
   üî¨ RESEARCH CONTEXT PRESERVATION:

   MCP Research Used in This Session:
   ‚Ä¢ Crawl4AI Sources: [LIST_OF_DOCUMENTATION_CRAWLED]
     - Key patterns extracted: [PATTERN_SUMMARY]
     - Framework best practices discovered: [PRACTICE_SUMMARY]

   ‚Ä¢ Octocode Repositories: [LIST_OF_REPOS_ANALYZED]
     - Successful implementations studied: [IMPLEMENTATION_SUMMARY]
     - Code patterns validated: [PATTERN_VALIDATION]

   ‚Ä¢ Sequential Thinking: [LIST_OF_ANALYSES_PERFORMED]
     - Architectural decisions analyzed: [DECISION_SUMMARY]
     - Multi-step reasoning preserved: [REASONING_CHAIN]

   ‚Ä¢ Brave Search: [INDUSTRY_STANDARDS_RESEARCHED]
     - Current best practices: [PRACTICE_SUMMARY]
     - Industry benchmarks: [BENCHMARK_DATA]

   Research Integration Status:
   ‚úÖ Preserve research provenance for future reference
   ‚úÖ Link decisions to supporting research evidence
   ‚úÖ Make research context accessible to future agents
   ```

2. **Pattern & Solution Documentation**:

   ```
   üìã PATTERN DOCUMENTATION:

   Proven Patterns Identified:
   ‚Ä¢ [PATTERN_NAME]: [PATTERN_DESCRIPTION_AND_USAGE]
     - Context: [WHERE_AND_WHY_APPLICABLE]
     - Implementation: [HOW_TO_APPLY_PATTERN]
     - Validation: [RESEARCH_OR_EVIDENCE_BACKING]

   Solution Documentation:
   ‚Ä¢ Problem: [PROBLEM_ADDRESSED]
   ‚Ä¢ Approach: [SOLUTION_APPROACH_TAKEN]
   ‚Ä¢ Outcome: [RESULTS_AND_VALIDATION]
   ‚Ä¢ Reusability: [HOW_PATTERN_CAN_BE_REUSED]
   ```

### Phase 4: Memory Creation & Pieces Integration (15 sec)

**Goal**: Create structured memory in Pieces with comprehensive tagging and research context.

1. **Pieces Memory Creation**:

   ```
   üìù CREATING PIECES MEMORY...

   Memory Structure:
   ‚Ä¢ Title: [VALIDATED_TITLE]
   ‚Ä¢ Summary: [VALIDATED_SUMMARY_WITH_RESEARCH_CONTEXT]
   ‚Ä¢ Content: [COMPREHENSIVE_CONTEXT_WITH_PATTERNS_AND_RESEARCH]
   ‚Ä¢ Tags: [VALIDATED_TAG_SCHEMA]
   ‚Ä¢ Project Context: [PROJECT_SPECIFIC_CONTEXT]
   ‚Ä¢ Research Provenance: [MCP_RESEARCH_SOURCES_AND_FINDINGS]

   Using Framework Taxonomy:
   ‚Ä¢ Namespace: framework
   ‚Ä¢ Agent Context: [RELEVANT_AGENT_TYPES]
   ‚Ä¢ Scope: [PROJECT_VS_GLOBAL_APPLICABILITY]
   ‚Ä¢ Content Type: [ARCHITECTURE/IMPLEMENTATION/RESEARCH/STANDARD]
   ‚Ä¢ Context Tags: [PROJECT_TECH_STACK_AND_DOMAIN_SPECIFIC]
   ```

2. **Cross-Reference & Link Creation**:

   ```
   üîó CROSS-REFERENCE INTEGRATION:

   Memory Connections:
   ‚Ä¢ Related Memories: [EXISTING_RELATED_MEMORIES_IF_FOUND]
   ‚Ä¢ Project Links: [CONNECTIONS_TO_PROJECT_SPECIFIC_MEMORIES]
   ‚Ä¢ Pattern Links: [CONNECTIONS_TO_SIMILAR_PATTERNS]
   ‚Ä¢ Research Links: [CONNECTIONS_TO_RELATED_RESEARCH_FINDINGS]

   Future Retrieval Optimization:
   ‚Ä¢ Query Keywords: [OPTIMIZED_FOR_NATURAL_LANGUAGE_QUERIES]
   ‚Ä¢ Context Clues: [OPTIMIZED_FOR_PROJECT_CONTEXT_QUERIES]
   ‚Ä¢ Agent Accessibility: [OPTIMIZED_FOR_AGENT_ROLE_BASED_RETRIEVAL]
   ```

### Phase 5: Validation & Accessibility Confirmation (10 sec)

**Goal**: Confirm memory creation success and provide guidance for future retrieval.

1. **Memory Creation Validation**:

   ```
   ‚úÖ MEMORY CREATION VALIDATION:

   Memory Successfully Created:
   ‚Ä¢ Pieces Memory ID: [GENERATED_MEMORY_ID]
   ‚Ä¢ Storage Timestamp: [UTC_TIMESTAMP]
   ‚Ä¢ Tag Schema Applied: [FINAL_TAG_SCHEMA]
   ‚Ä¢ Research Context Preserved: [RESEARCH_PRESERVATION_STATUS]

   Accessibility Verification:
   ‚Ä¢ Memory searchable by: [PRIMARY_SEARCH_TERMS]
   ‚Ä¢ Available to agents: [AGENT_ACCESSIBILITY_SCOPE]
   ‚Ä¢ Project context: [PROJECT_SPECIFIC_CONTEXT_PRESERVED]
   ```

2. **Future Retrieval Guidance**:

   ```
   üéØ MEMORY RETRIEVAL GUIDANCE:

   To retrieve this memory in future sessions:

   üìã RECOMMENDED QUERIES:
   ‚Ä¢ Primary: "[PRIMARY_RETRIEVAL_QUERY]"
   ‚Ä¢ Context-based: "[CONTEXT_BASED_QUERY]"
   ‚Ä¢ Pattern-based: "[PATTERN_BASED_QUERY]"
   ‚Ä¢ Project-specific: "[PROJECT_SPECIFIC_QUERY]"

   ü§ñ AGENT INTEGRATION:
   This memory will be accessible to:
   ‚Ä¢ All framework agents through ask_pieces_ltm queries
   ‚Ä¢ Context-aware load-context command searches
   ‚Ä¢ Project-specific agent coordination workflows
   ‚Ä¢ Cross-project pattern discovery processes

   üí° OPTIMIZATION TIPS:
   ‚Ä¢ Include project name in queries for project-specific context
   ‚Ä¢ Use technology stack terms for tech-specific patterns
   ‚Ä¢ Reference agent types for role-specific insights
   ‚Ä¢ Combine multiple tags for precise retrieval
   ```

## Memory Tagging Taxonomy

### Framework Tagging Schema

```
{namespace}:{agent}:{scope}:{content_type}:{context}

Components:
‚Ä¢ namespace: framework | project | global
‚Ä¢ agent: developer | tester | researcher | docs | coordinator
‚Ä¢ scope: project | global | domain
‚Ä¢ content_type: architecture | implementation | research | standard | pattern | decision
‚Ä¢ context: [tech_stack] | [project_domain] | [specific_context]
```

### Content Classification System

```
Primary Categories:
‚Ä¢ architecture: Design decisions, system structure, component organization
‚Ä¢ implementation: Code patterns, proven solutions, technical approaches
‚Ä¢ research: MCP findings, industry standards, best practice discoveries
‚Ä¢ standard: Quality gates, testing approaches, validation criteria
‚Ä¢ pattern: Reusable solutions, design patterns, workflow templates
‚Ä¢ decision: Critical choices, escalation triggers, user preferences

Secondary Tags:
‚Ä¢ Technology: python | typescript | rust | nodejs | react | fastapi
‚Ä¢ Domain: api | ui | database | testing | deployment | security
‚Ä¢ Agent: developer | tester | docs | researcher | coordinator
‚Ä¢ Priority: critical | important | reference | experimental
```

## Success Criteria

### Context Extraction Success

- Accurately identifies key insights, decisions, and patterns from session
- Captures research context including MCP tool findings and sources
- Preserves implementation patterns and quality standards applied
- Documents user preferences and project-specific requirements

### Memory Organization Success (Strong HITL)

- Users maintain full control over what gets preserved and how it's tagged
- Comprehensive tagging schema enables precise future retrieval
- Memory connections facilitate cross-project pattern discovery
- Research provenance is maintained for evidence-based decision making

### Pieces Integration Success

- Memory successfully created with comprehensive metadata
- Tags applied according to framework taxonomy for optimal retrieval
- Cross-references established with related memories and patterns
- Content optimized for natural language queries by future agents

### Future Accessibility Success

- Memories retrievable through multiple query strategies
- Agent coordination workflows can access relevant context
- Project-specific context preserved for targeted retrieval
- Pattern reusability documented for cross-project application

### Research Context Preservation Success

- MCP research findings preserved with source attribution
- Decision rationale documented with supporting evidence
- Pattern validation maintained for future confidence
- Industry benchmarks and standards captured for reference
