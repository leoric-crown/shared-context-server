# Shared Context MCP Server Environment Configuration
# Copy this file to .env and update with your actual values
#
# IMPORTANT: Add .env to .gitignore to prevent credential exposure
#
# Updated configuration based on consultant review addressing:
# - Unified database configuration approach
# - Optimized settings for production deployment
# - Clear security guidelines and validation requirements

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================

# Database file path (SQLite)
# Use absolute path for production, relative path for development
DATABASE_PATH=./chat_history.db

# Alternative: If using database URL format (keep only one approach)
# DATABASE_URL=sqlite:///./chat_history.db

# Database connection settings
# Maximum concurrent connections (for connection pooling)
DATABASE_MAX_CONNECTIONS=20
DATABASE_MIN_CONNECTIONS=2

# Database timeout settings (in seconds)
DATABASE_TIMEOUT=30
DATABASE_BUSY_TIMEOUT=5

# ============================================================================
# MCP SERVER CONFIGURATION
# ============================================================================

# MCP server identification
MCP_SERVER_NAME=shared-context-server
MCP_SERVER_VERSION=1.0.0

# Server transport configuration
MCP_TRANSPORT=http

# HTTP transport settings (only used when MCP_TRANSPORT=http)
HTTP_HOST=localhost
HTTP_PORT=23456

# Client-accessible hostname (for MCP client configuration)
# This is the hostname that MCP clients should use to connect to the server
# Usually 'localhost' for local development, or your server's public hostname/IP for remote access
MCP_CLIENT_HOST=localhost


# ============================================================================
# AUTHENTICATION & SECURITY
# ============================================================================

# API key for agent authentication (REQUIRED - generate secure random key)
# Example: openssl rand -base64 32
API_KEY=your-secure-api-key-replace-this-in-production

# JWT secret key for token-based authentication (Phase 3)
# Example: openssl rand -base64 64
JWT_SECRET_KEY=your-jwt-secret-key-replace-this-in-production

# JWT token expiration time (in seconds)
JWT_EXPIRATION_TIME=86400

# Session security settings
SESSION_TIMEOUT=3600
MAX_SESSIONS_PER_AGENT=50

# ============================================================================
# OPERATIONAL CONFIGURATION
# ============================================================================

# Logging configuration
LOG_LEVEL=INFO
LOG_FORMAT=%(asctime)s - %(name)s - %(levelname)s - %(message)s

# Enable detailed SQL logging (set to DEBUG for development)
DATABASE_LOG_LEVEL=INFO

# Performance monitoring
ENABLE_PERFORMANCE_MONITORING=true
PERFORMANCE_LOG_INTERVAL=300

# ============================================================================
# CORS & WEB SECURITY (if HTTP transport enabled)
# ============================================================================

# CORS origins (comma-separated list)
CORS_ORIGINS=*

# Security headers (production should be more restrictive)
ENABLE_SECURITY_HEADERS=true
ALLOWED_HOSTS=localhost,127.0.0.1

# ============================================================================
# MEMORY & STORAGE LIMITS
# ============================================================================

# Agent memory limits
MAX_MEMORY_ENTRIES_PER_AGENT=1000
MAX_MEMORY_SIZE_MB=100

# Message limits
MAX_MESSAGE_LENGTH=100000
MAX_MESSAGES_PER_SESSION=10000

# Session limits
MAX_SESSION_DURATION_HOURS=168
SESSION_CLEANUP_INTERVAL=3600

# Metadata size limits
MAX_METADATA_SIZE_KB=10

# ============================================================================
# CACHE CONFIGURATION
# ============================================================================

# Enable in-memory caching
ENABLE_CACHING=true

# Cache TTL settings (in seconds)
CACHE_TTL_SESSIONS=300
CACHE_TTL_MESSAGES=180
CACHE_TTL_MEMORY=600

# Cache size limits (number of items)
CACHE_MAX_SIZE_L1=1000
CACHE_MAX_SIZE_L2=5000

# ============================================================================
# CLEANUP & MAINTENANCE
# ============================================================================

# Automatic cleanup settings
ENABLE_AUTOMATIC_CLEANUP=true
CLEANUP_INTERVAL=3600

# Data retention policies (in days)
AUDIT_LOG_RETENTION_DAYS=30
INACTIVE_SESSION_RETENTION_DAYS=7

# Cleanup thresholds
CLEANUP_EXPIRED_MEMORY=true
CLEANUP_OLD_SESSIONS=true
CLEANUP_AUDIT_LOGS=true

# ============================================================================
# DEVELOPMENT & DEBUGGING
# ============================================================================

# Environment mode
ENVIRONMENT=development

# Debug settings (disable in production)
DEBUG=false
ENABLE_DEBUG_TOOLS=false

# Development database settings
DEV_RESET_DATABASE_ON_START=false
DEV_SEED_TEST_DATA=false

# Testing configuration
TEST_DATABASE_PATH=./test_chat_history.db
ENABLE_TEST_FIXTURES=false

# ============================================================================
# MONITORING & HEALTH CHECKS
# ============================================================================

# Health check settings
HEALTH_CHECK_INTERVAL=60
HEALTH_CHECK_TIMEOUT=10

# Metrics collection
ENABLE_METRICS=true
METRICS_PORT=9090

# Performance thresholds (for alerting)
MAX_RESPONSE_TIME_MS=100
MAX_CONNECTION_TIME_MS=1000

# Resource monitoring
MONITOR_MEMORY_USAGE=true
MONITOR_DATABASE_SIZE=true
MONITOR_CONNECTION_POOL=true

# ============================================================================
# AGENT COORDINATION
# ============================================================================

# Multi-agent settings
MAX_CONCURRENT_AGENTS=25
AGENT_HEARTBEAT_INTERVAL=30
AGENT_TIMEOUT=300

# Session coordination
ENABLE_SESSION_LOCKING=true
SESSION_LOCK_TIMEOUT=300
MAX_COORDINATION_CHANNELS=100

# ============================================================================
# BACKUP & RECOVERY (Production)
# ============================================================================

# Backup configuration
ENABLE_AUTOMATIC_BACKUP=false
BACKUP_INTERVAL_HOURS=24
BACKUP_RETENTION_DAYS=30
BACKUP_DIRECTORY=./backups

# Database maintenance
ENABLE_AUTO_VACUUM=true
VACUUM_INTERVAL_HOURS=168

# ============================================================================
# PRODUCTION DEPLOYMENT
# ============================================================================

# Production security settings (uncomment for production)
# SECURE_COOKIES=true
# HTTPS_ONLY=true
# ENABLE_RATE_LIMITING=true
# RATE_LIMIT_REQUESTS_PER_MINUTE=1000

# Process management
# WORKERS=1
# MAX_REQUESTS_PER_WORKER=10000
# PRELOAD_APP=true

# Resource limits
# MAX_MEMORY_USAGE_MB=1024
# MAX_CPU_USAGE_PERCENT=80

# ============================================================================
# VALIDATION NOTES
# ============================================================================

# SECURITY CHECKLIST:
# □ Replace default API_KEY with secure random value
# □ Replace default JWT_SECRET_KEY with secure random value
# □ Set appropriate LOG_LEVEL for environment
# □ Configure CORS_ORIGINS appropriately for production
# □ Review and adjust resource limits for your deployment
# □ Enable automatic cleanup and backup for production
# □ Set DEBUG=false for production
# □ Use HTTPS_ONLY=true for production deployment

# PERFORMANCE CHECKLIST:
# □ Adjust DATABASE_MAX_CONNECTIONS based on expected load
# □ Configure cache settings for your memory constraints
# □ Set appropriate retention policies for your storage
# □ Monitor performance thresholds and adjust as needed
# □ Configure backup frequency based on change rate

# OPERATIONAL CHECKLIST:
# □ Set up log rotation and monitoring
# □ Configure health checks and alerting
# □ Plan database maintenance windows
# □ Test backup and recovery procedures
# □ Document environment-specific configurations
